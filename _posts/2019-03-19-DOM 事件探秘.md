---
layout: post
title: DOM 事件探秘
date: 2019-03-19
categories: DOM
tags: JavaScript DOM
---

# DOM 事件探秘
## 1. 事件(Event)
* 事件是文档或浏览器窗口中发生的特定的交互瞬间。
* 事件流：描述的是从页面中接受事件的顺序 （IE：事件冒泡流 / Netscape事件捕获流）
	* 事件冒泡：即事件最开始由最具体的元素（文档中嵌套层次最深的那个节点）接收，然后逐级向上传播至最不具体的那个节点（document）
	* 事件捕获：不太具体的节点应该更具体的接收到事件，而最具体的节点以后接收到事件  
	* W3C事件阶段(event phase)：当一个DOM事件被触发的时候，他并不是只在它的起源对象上触发一次，而是会经历三个不同的阶段。简而言之：事件一开始从文档的根节点流向目标对象(捕获阶段)，然后在目标对向上被触发(目标阶段)，之后再回溯到文档的根节点(冒泡阶段)

		![](/img/DOM-1.png)

		* 事件捕获阶段(Capture Phase)：事件从文档的根节点出发，随着DOM树的结构向事件的目标节点流去。途中经过各个层次的DOM节点，并在各节点上触发捕获事件，直到到达时间的目标节点。捕获阶段的主要任务是简历传播路径，在冒泡阶段，时间会通过这个路径回溯到文档根节点。而，在实际应用中，我们并没有太多使用捕获阶段监听的用例，但是通过在捕获阶段对事件的处理，我们可以阻止类似click事件在某个特定元素上被触发。如下：

			```
			var form=document.querySeletor('form');
			form.addEventListener('click',function(e){
				e.stopPropagation();
			},true);
			```
		
		* 目标阶段(Target Phase): 当事件到达目标节点时，事件就进入了目标阶段。事件在目标节点上被触发，然后逆向回流，知道传播到最外层的文档节点。对于多层嵌套的节点，鼠标和指针事件经常会被定位到最里层的元素上。假设，你在一个div元素上设置了click的监听函数，而用户点击在了这个div元素内部的p元素上，那么p元素就是这个事件的目标元素。事件冒泡让我们可以在这个div或者更上层的元素上监听click事件，并且时间传播过程中触发回调函数。
		* 冒泡阶段(Bubble Phase): 事件在目标事件上触发后，并不在这个元素上终止。它会随着DOM树一层层向上冒泡，直到到达最外层的根节点，一直向上传播，直到document对象。也就是说，同一事件会一次在目标节点的父节点，父节点的父节点...直到最外层的节点上触发。绝大多数事件是会冒泡的，但并非所有的。

* 阻止事件冒泡：
	* 1.`event.stopPropagation()`  事件处理过程中，阻止了事件冒泡，但不会阻击默认行为
	* 2.`return false`
		* `javascript`的`return false`只会阻止默认行为，
		* 而是用`jQuery`的话则既阻止默认行为又防止对象冒泡
	* 3.还有一种有冒泡有关的：`event.preventDefault()`事件处理过程中，不阻击事件冒泡，但阻击默认行为

## 2. 事件处理程序
* 2.1. HTML事件处理程序
	* 直接把事件加在HTML中的元素节点上
	* 缺点HTML和JS代码太紧密的耦合	 
* 2.2 DOM 0级事件处理程序
	* 较传统的方法：把一个函数赋值给一个事件的处理程序属性
	* 用的比较多的方法，简单，跨浏览器优势 
* 2.3 DOM 2级事件处理程序

	> 定义了两个方法：用于处理指定和删除的处理程序的操作
	
	* `addEventListner()`
	* `removeEventListner()`
	* 接收三个参数：
		* 要处理的事件名
		* 作为事件处理程序的函数
		* 布尔值（true：表示在捕获阶段；false：表示在冒泡阶段） 
	* 优点：可以给一个元素添加多个事件，多个事件处理程序（DOM 0级也有此优点）

* 2.4 IE事件处理程序(IE 和 Opera)
	* `attachEvent()`添加事件
	* `detachEvent()` 删除事件
	* 接收相同的两个参数：事件处理程序的名称，和事件处理程序函数

* 2.5 跨浏览器的事件处理
	用一个判断来检测浏览器是否支持此方法
	
## 3. 事件对象
> 概念： 在触发DOM上的事件时都会产生一个对象（Event）
 
* DOM中的事件对象
	*  `type` 属性: 用于获取事件的类型
	*  `target` 属性: 用于获取事件的目标(触发此事件的元素)
	*  `bubbles` 属性: 返回布尔值，指示事件是否是起泡事件类型。
	*  `cancelable` 属性: 返回布尔值，指示事件是否可拥可取消的默认动作。
	*  `currentTarget` 属性: 返回其事件监听器触发该事件的元素。
	*  `eventPhase`属性:	返回事件传播的当前阶段。
	*  `timeStamp` 属性:	返回事件生成的日期和时间。
	*  `event.stopPropagation()` 方法：阻止事件冒泡
	*  `event.preventDefault()` 方法： 阻止事件的默认行为
	*  `event.initEvent(eventType,canBubble,cancelable)` 方法：初始化新创建的 Event 对象的属性。

* IE中的事件对象
	*  `type` 属性: 用于获取事件的类型
	*  `srcElement` 属性: 用于获取事件的目标(触发此事件的元素)
	*  `cancelBubble` 属性：	如果事件句柄想阻止事件传播到包容对象，必须把该属性设为 `true`。
	*  `returnValue`属性：如果设置了该属性，它的值比事件句柄的返回值优先级高。把这个属性设置为 `fasle`，可以取消发生事件的源元素的默认动作。

## 四.事件类型

事件类型有：

* UI（用户界面）事件，用户与页面上元素交互时触发 ；
* 焦点事件：当元素获得或失去焦点时触发 ； 
* 文本事件：当在文档中输入文本时触发；
* 键盘事件：当用户通过键盘在页面上执行操作时触发；
* 鼠标事件：当用户通过鼠标在页面上执行操作时触发；
* 滚轮事件：当使用鼠标滚轮（或类似设备）时触发。它们之间是继承的关系

	![](/img/DOM-2.jpg)

* 注：` mouseenter`和`mouseover`，`mouseleave`和`mouseout`的区别：

1.不论鼠标指针离开被选元素还是任何子元素，都会触发 `mouseout` 事件。

2.只有在鼠标指针离开被选元素时，才会触发 `mouseleave` 事件。

# DOM Document 对象
* 每个载入浏览器的 HTML 文档都会成为 Document 对象。Document 对象使我们可以从脚本中对 HTML 页面中的所有元素进行访问。
* 提示：Document 对象是 Window 对象的一部分，可通过 `window.document` 属性对其进行访问。

# DOM Element 对象
##  DOM 节点
在 HTML DOM （文档对象模型）中，每个部分都是节点：

* 文档本身是**文档节点**
* 所有 HTML 元素是**元素节点**
* 所有 HTML 属性是**属性节点**
* HTML 元素内的文本是**文本节点**
* 注释是**注释节点**

## Element 对象
* 在 HTML DOM 中，Element 对象表示 HTML 元素。
* Element 对象可以拥有类型为元素节点、文本节点、注释节点的子节点。
* NodeList 对象表示节点列表，比如 HTML 元素的子节点集合。
* 元素也可以拥有属性。属性是属性节点


	
	